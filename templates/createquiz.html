<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Quiz</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v={{ cache_buster }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

<!-- With this: -->
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v={{ cache_buster }}">
    <style>
        /* Quiz Creation Styles */
        .quiz-creation-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .quiz-header h2 {
            color: #333;
            margin-bottom: 0.5rem;
        }

        .quiz-header p {
            color: #666;
            line-height: 1.6;
        }

        .quiz-form {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .question-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .question-section h3 {
            margin-top: 0;
            color: #333;
        }

        .question-item {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-number {
            font-weight: 600;
            color: #333;
        }

        .remove-question {
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-group {
            margin: 1rem 0;
        }

        .option-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .option-item input[type="radio"] {
            margin-right: 0.5rem;
        }

        .option-item input[type="text"] {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .add-option,
        .add-question {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .add-option:hover,
        .add-question:hover {
            background: #e55a2b;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-reset {
            background: rgb(255, 222, 180);
            color:black;
        }

        .btn-reset:hover {
            background: rgb(255, 209, 150);
        }

        .btn-create {
            border: 1px dashed #ff4757;
            background: #ffeee0;
            color: orangered;
        }

        .btn-create:hover {
            background: #ffdec3;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .quiz-creation-container {
                margin: 1rem auto;
            }
            
            .quiz-form {
                padding: 1.5rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="main">
      <nav class="navbar" id="nav">
            <div class="logo">
                <img src="{{ url_for('static', filename='logo1.png') }}" alt="" height="45px" width="45px" style="border-radius: 50%;">
                <h1>Quizzy</h1>
            </div>
            <div class="links">
                <a href="{{ url_for('adminhome') }}">
                    <p>Home</p>
                </a>
                <a href="{{ url_for('admindashboard') }}">
                    <p>Dashboard</p>
                </a>
                <a href="{{ url_for('gettoknowus') }}">
                <p>About Us</p>
            </a>
<a href="#"><button id="logoutBtn">Logout</button></a>
            </div>
            <button class="button2" onclick="ExpandNav()">
                <i class="fa-solid fa-bars" id="menubar"></i>
            </button>
        </nav>

        <section>
            <div class="quiz-creation-container">
                <div class="quiz-header">
                    <h2>Create a New Quiz</h2>
                    <p>Fill out the form below to create your own quiz. Add questions, set correct answers, and customize the settings to make it perfect for your audience.</p>
                </div>

                <form class="quiz-form" id="quizForm">
    <div class="form-group">
        <label for="quiz-title">Quiz Title</label>
        <input type="text" id="quiz-title" name="title" placeholder="Enter a catchy title for your quiz" required>
    </div>

    <div class="form-group">
        <label for="quiz-description">Description</label>
        <textarea id="quiz-description" name="description" placeholder="What is this quiz about?"></textarea>
    </div>

    <div class="form-group">
        <label for="quiz-category">Category</label>
        <select id="quiz-category" name="category" required>
            <option value="">Select a category</option>
        </select>
    </div>

    <div class="form-group">
        <label for="quiz-difficulty">Difficulty Level</label>
        <select id="quiz-difficulty" name="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
        </select>
    </div>

    <!-- Questions Section -->
    <div class="question-section">
        <h3>Questions</h3>
        
        <!-- Question Item Template -->
        <div class="question-item">
            <div class="question-header">
                <span class="question-number">Question 1</span>
                <button type="button" class="remove-question"><i class="fas fa-times"></i></button>
            </div>
            <div class="form-group">
                <input type="text" name="question-1" placeholder="Enter your question" required>
            </div>
            
            <div class="options-group">
                <div class="option-item">
                    <input type="radio" name="q1-correct" value="0" checked>
                    <input type="text" name="q1-option-0" placeholder="Option 1" required>
                </div>
                <div class="option-item">
                    <input type="radio" name="q1-correct" value="1">
                    <input type="text" name="q1-option-1" placeholder="Option 2" required>
                </div>
                <div class="option-item">
                    <input type="radio" name="q1-correct" value="2">
                    <input type="text" name="q1-option-2" placeholder="Option 3">
                </div>
                <div class="option-item">
                    <input type="radio" name="q1-correct" value="3">
                    <input type="text" name="q1-option-3" placeholder="Option 4">
                </div>
            </div>
            
            <button type="button" class="add-option"><i class="fas fa-plus"></i> Add Another Option</button>
        </div>
        
        <button type="button" class="add-question"><i class="fas fa-plus"></i> Add Another Question</button>
    </div>

    <div class="form-actions">
        <button type="reset" class="btn btn-reset">Reset</button>
        <button type="submit" class="btn btn-create">Create Quiz</button>
    </div>
</form>
            </div>
            <!-- Add this after your existing modals -->
<div class="modalscreen" id="logoutModal" style="display: none;">
    <div class="categorymodal">
        <div class="up"><b>Logout</b></div>
        <div class="center">
            <p>Are you sure that you want to logout?</p>
        </div>
        <div class="down">
            <button type="button" id="cancelLogoutBtn">Cancel</button>
            <button type="button" id="confirmLogoutBtn">Logout</button>
        </div>
    </div>
</div>
        </section>

        <footer>
            <p>Â© 2025 Quizzy. All rights reserved.</p>
        </footer>
    </div>
<script>

        function showLogoutModal() {
        const modal = document.getElementById("logoutModal");
        if (modal) modal.style.display = 'flex';
    }

    function hideLogoutModal() {
        const modal = document.getElementById("logoutModal");
        if (modal) modal.style.display = 'none';
    }

    async function confirmLogout() {
        try {
            // Perform logout API call if needed
            // await fetch('/api/logout', { method: 'POST' });
            
            // Redirect to login page
            window.location.href = '/login';
        } catch (error) {
            console.error("Error during logout:", error);
            // Fallback redirect if API call fails
            window.location.href = '/login';
        }
    }

     function initializePage() {
        // Add these event listeners
        const logoutBtn = document.getElementById("logoutBtn");
        const cancelLogoutBtn = document.getElementById("cancelLogoutBtn");
        const confirmLogoutBtn = document.getElementById("confirmLogoutBtn");
        
        if (logoutBtn) {
            logoutBtn.addEventListener("click", function(e) {
                e.preventDefault();
                showLogoutModal();
            });
        }
        
        if (cancelLogoutBtn) {
            cancelLogoutBtn.addEventListener("click", hideLogoutModal);
        }
        
        if (confirmLogoutBtn) {
            confirmLogoutBtn.addEventListener("click", confirmLogout);
        }
    }

     if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
    document.addEventListener('DOMContentLoaded', async function() {
        // Load categories from the API
        try {
            const response = await fetch('/api/categories', {
                credentials: 'include'
            });
            
            if (!response.ok) {
                if (response.status === 401) {
                    window.location.href = '/login';
                    return;
                }
                throw new Error('Failed to load categories');
            }
            
            const categories = await response.json();
            const select = document.getElementById('quiz-category');
            
            select.innerHTML = '<option value="">Select a category</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name;
                select.appendChild(option);
            });
        } catch (error) {
            console.error("Error loading categories:", error);
            document.getElementById('quiz-category').innerHTML = 
                '<option value="">Error loading categories</option>';
        }

        // Add question functionality
        const addQuestionBtn = document.querySelector('.add-question');
        const questionsContainer = document.querySelector('.question-section');
        let questionCounter = 1;

        // Function to add a new question
        function addNewQuestion() {
            questionCounter++;
            const newQuestion = document.createElement('div');
            newQuestion.className = 'question-item';
            newQuestion.innerHTML = `
                <div class="question-header">
                    <span class="question-number">Question ${questionCounter}</span>
                    <button type="button" class="remove-question"><i class="fas fa-times"></i></button>
                </div>
                <div class="form-group">
                    <input type="text" name="question-${questionCounter}" placeholder="Enter your question" required>
                </div>
                
                <div class="options-group">
                    <div class="option-item">
                        <input type="radio" name="q${questionCounter}-correct" value="0" checked>
                        <input type="text" name="q${questionCounter}-option-0" placeholder="Option 1" required>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="q${questionCounter}-correct" value="1">
                        <input type="text" name="q${questionCounter}-option-1" placeholder="Option 2" required>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="q${questionCounter}-correct" value="2">
                        <input type="text" name="q${questionCounter}-option-2" placeholder="Option 3">
                    </div>
                </div>
                
                <button type="button" class="add-option"><i class="fas fa-plus"></i> Add Another Option</button>
            `;
            
            questionsContainer.insertBefore(newQuestion, addQuestionBtn);
            
            // Add event listeners to the new question
            newQuestion.querySelector('.remove-question').addEventListener('click', function() {
                if (document.querySelectorAll('.question-item').length > 1) {
                    newQuestion.remove();
                    updateQuestionNumbers();
                } else {
                    alert("You need to have at least one question!");
                }
            });
            
            newQuestion.querySelector('.add-option').addEventListener('click', function() {
                addOptionToQuestion(newQuestion, questionCounter);
            });
        }

        // Function to add an option to a question
        function addOptionToQuestion(questionItem, questionNumber) {
            const optionsGroup = questionItem.querySelector('.options-group');
            const optionCount = optionsGroup.querySelectorAll('.option-item').length;
            
            const newOption = document.createElement('div');
            newOption.className = 'option-item';
            newOption.innerHTML = `
                <input type="radio" name="q${questionNumber}-correct" value="${optionCount}">
                <input type="text" name="q${questionNumber}-option-${optionCount}" placeholder="Option ${optionCount + 1}">
            `;
            
            optionsGroup.appendChild(newOption);
        }

        // Function to update question numbers after removal
        function updateQuestionNumbers() {
            const questions = document.querySelectorAll('.question-item');
            questions.forEach((question, index) => {
                const questionNumber = index + 1;
                question.querySelector('.question-number').textContent = `Question ${questionNumber}`;
                
                // Update question input name
                const questionInput = question.querySelector('.form-group input[type="text"]');
                questionInput.name = `question-${questionNumber}`;
                
                // Update option names and radio buttons
                const optionItems = question.querySelectorAll('.option-item');
                optionItems.forEach((optionItem, optionIndex) => {
                    const optionInput = optionItem.querySelector('input[type="text"]');
                    optionInput.name = `q${questionNumber}-option-${optionIndex}`;
                    
                    const radioInput = optionItem.querySelector('input[type="radio"]');
                    radioInput.name = `q${questionNumber}-correct`;
                    radioInput.value = optionIndex;
                });
            });
            
            // Update the global question counter
            questionCounter = questions.length;
        }

        // Add event listeners
        addQuestionBtn.addEventListener('click', addNewQuestion);
        
        document.querySelector('.remove-question').addEventListener('click', function() {
            const questionItem = this.closest('.question-item');
            if (document.querySelectorAll('.question-item').length > 1) {
                questionItem.remove();
                updateQuestionNumbers();
            } else {
                alert("You need to have at least one question!");
            }
        });
        
        document.querySelector('.add-option').addEventListener('click', function() {
            const questionItem = this.closest('.question-item');
            const questionNumber = parseInt(questionItem.querySelector('.question-number').textContent.replace('Question ', ''));
            addOptionToQuestion(questionItem, questionNumber);
        });
        
        const navbar = document.querySelector('.navbar');
        const menuButton = document.querySelector('.button2');
        
        menuButton.addEventListener('click', function() {
            navbar.classList.toggle('expanded');
        });
    });

    document.getElementById('quizForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const quizData = {
            title: formData.get('title'),
            description: formData.get('description'),
            category: formData.get('category'),
            difficulty: formData.get('difficulty'),
            questions: []
        };
        
        const questionItems = document.querySelectorAll('.question-item');
        
        for (let i = 0; i < questionItems.length; i++) {
            const questionItem = questionItems[i];
            const questionNumber = i + 1;
            
            // Get question text
            const questionInput = questionItem.querySelector('.form-group input[type="text"]');
            const questionText = questionInput.value;
            
            // Get options
            const options = [];
            const optionInputs = questionItem.querySelectorAll('.option-item input[type="text"]');
            for (let j = 0; j < optionInputs.length; j++) {
                if (optionInputs[j].value.trim() !== '') {
                    options.push(optionInputs[j].value);
                }
            }
            
            // Get correct answer
            const correctAnswerRadio = questionItem.querySelector(`input[name="q${questionNumber}-correct"]:checked`);
            let correctAnswerIndex = 0;
            if (correctAnswerRadio) {
                correctAnswerIndex = parseInt(correctAnswerRadio.value);
            }
            
            quizData.questions.push({
                question: questionText,
                options: options,
                correctAnswer: correctAnswerIndex
            });
        }
        
        try {
            const response = await fetch('/api/quizzes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(quizData)
            });
            
            if (response.ok) {
                alert('Quiz created successfully!');
                window.location.href = `/categories/${encodeURIComponent(quizData.category)}`;
            } else {
                const error = await response.json();
                alert('Error creating quiz: ' + error.error);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred while creating the quiz.');
        }
    });
</script>
</body>
</html>